{% extends "app/layout.html" %}

{% load staticfiles %}

{% block head-scripts %}
    <!--<link rel="stylesheet" type="text/css" href="{% static 'blast/css/jquery-ui.min.css' %}" />-->
    <link href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
    <style>
        .progress-label {
            float: left;
            margin-left: 50%;
            margin-top: 5px;
            font-weight: bold;
            text-shadow: 1px 1px 0 #fff;
        }
    </style>
{% endblock %}

{% block content %}
{% if isNoHits %}
<h2>No Hits Found</h2>
<!--<h3>No hits found on your query. <a href="{% url 'blast:create' %}">Try another.</a></h3>-->
<h3>No hits found on your query. <a href="../blast">Try another.</a></h3>
{% elif isExpired %}
<h2>Query Expired</h2>
<h3>Submission time: {{ enqueue_date }}</h3>
<!--<p>Your query is expired. Please <a href="{% url 'blast:create' %}">try another query.</a></p>-->
<p>Your query is expired. Please <a href="../blast">try another query.</a></p>
{% else %}
<h2>Query Submitted</h2>
<h3>Submission time: {{ enqueue_date }}</h3>
<p>Your query is running. Please wait a moment or <a href="{% url 'blast:retrieve' task_id %}">link back to this page</a> later to check results</p>
<div id="progressbar-1"><div class="progress-label"></div></div> 
{% endif %}
{% endblock %}

{% block scripts %}
    {% if not isExpired and not isNoHits %}
    <!--<script src="{% static 'blast/scripts/jquery-ui.min.js' %}"></script>-->
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
    <script>
    $(document).ready(function () {
        setInterval( function(){retrieve();},2000);
    });
    function retrieve() {
        $.ajax({
            type: 'GET',
            url: './{{task_id}}/status',
            dataType: "json",
            error: function () {
                // do nothing
            },
            success: function (data) {
                //console.log(data['status']);
                if (data['status'] == 'done') {
                    $( "#progressbar-1" ).progressbar({
                        value: 100
                    });
                    window.location.reload(1);
                }
                else if(data['status'] == 'pending') {
                    $( "#progressbar-1" ).progressbar({
                        value: data['processed'],
                        max: data['seq_count']
                    });
                    $( ".progress-label" ).text(data['processed'] + "/" + data['seq_count']);
                }
            }
        });
    }
    </script>
    {% endif %}
{% endblock %}
